<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organiser Kelas</title>
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --secondary-color: #e8f5e9;
            --text-color: #333;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --gradient: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--gradient);
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
        }

        .login-form {
            background-color: var(--white);
            padding: 40px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }

        /* Main App */
        .app {
            display: none;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info button {
            background-color: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            background-color: var(--white);
            box-shadow: var(--shadow);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
        }

        .tab:hover {
            background-color: var(--secondary-color);
        }

        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: white;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: var(--white);
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        /* Home Tab */
        .class-profile {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            align-items: flex-start;
        }

        .class-photo {
            flex: 1;
            max-width: 350px;
            position: relative;
        }

        .class-photo img {
            width: 100%;
            border-radius: 15px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .class-photo img:hover {
            transform: scale(1.02);
        }

        .photo-upload-home {
            margin-top: 15px;
            text-align: center;
        }

        .class-info {
            flex: 2;
        }

        .class-info h2 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-size: 28px;
        }

        .class-info p {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .wali-kelas-card {
            display: flex;
            align-items: center;
            gap: 20px;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: var(--shadow);
        }

        .wali-kelas-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
        }

        .wali-kelas-info h3 {
            margin-bottom: 5px;
            font-size: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
            box-shadow: var(--shadow);
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .info-card .number {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Data Tab */
        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 250px;
        }

        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: var(--shadow);
            border-radius: 10px;
            overflow: hidden;
        }

        .students-table th,
        .students-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .students-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .students-table tr:hover {
            background-color: var(--secondary-color);
        }

        .student-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-light);
        }

        .photo-upload {
            position: relative;
            display: inline-block;
        }

        .photo-upload input {
            display: none;
        }

        .photo-upload label {
            background-color: var(--primary-light);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
            display: block;
            text-align: center;
        }

        .photo-upload label:hover {
            background-color: var(--primary-color);
        }

        .ujian-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Nilai Tab */
        .nilai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-upload input {
            display: none;
        }

        .file-upload label {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .nilai-table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .nilai-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        .nilai-table th,
        .nilai-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .nilai-table th {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
        }

        .nilai-table input {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .empty-nilai {
            margin-top: 30px;
            padding: 20px;
            background-color: #ffebee;
            border-radius: 10px;
            border-left: 4px solid #f44336;
            box-shadow: var(--shadow);
        }

        .empty-nilai h3 {
            color: #d32f2f;
            margin-bottom: 15px;
        }

        .subject-group {
            margin-bottom: 20px;
        }

        .subject-group h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .student-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .student-tag {
            background-color: var(--secondary-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .student-tag img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        /* Setelan Tab */
        .settings-content {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .settings-content h2 {
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        .logout-btn {
            background-color: #f44336;
            margin-top: 30px;
        }

        .logout-btn:hover {
            background-color: #d32f2f;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--primary-dark);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }

        .cancel-btn {
            background-color: #757575;
        }

        .cancel-btn:hover {
            background-color: #616161;
        }

        /* Photo Preview */
        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            margin: 10px 0;
            border-radius: 10px;
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .class-profile {
                flex-direction: column;
            }
            
            .class-photo {
                max-width: 100%;
            }
            
            .data-header, .nilai-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-box {
                width: 100%;
            }
            
            .search-box input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h2>Login Organiser Kelas</h2>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="loginBtn" class="btn">Login</button>
            <p style="text-align: center; margin-top: 15px; color: #666;">Gunakan: admin / admin</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">Organiser Kelas</div>
                    <div class="user-info">
                        <span>Admin</span>
                        <button id="logoutBtn">Logout</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="tabs">
                <div class="tab active" data-tab="home">Home</div>
                <div class="tab" data-tab="data">Data Siswa</div>
                <div class="tab" data-tab="nilai">Nilai</div>
                <div class="tab" data-tab="setelan">Setelan</div>
            </div>

            <!-- Home Tab Content -->
            <div id="home" class="tab-content active">
                <div class="class-profile">
                    <div class="class-photo">
                        <img id="classPhoto" src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80" alt="Foto Kelas">
                        <img id="classPhotoPreview" class="photo-preview" alt="Preview Foto Kelas">
                        <div class="photo-upload-home">
                            <input type="file" id="uploadClassPhoto" accept="image/*">
                            <label for="uploadClassPhoto" class="btn btn-small">Ganti Foto Kelas</label>
                        </div>
                    </div>
                    <div class="class-info">
                        <h2>Profil Kelas X IPA 1</h2>
                        <p>Kelas X IPA 1 adalah kelas dengan siswa-siswa berprestasi di bidang sains. Kelas ini dipimpin oleh Wali Kelas Bapak Ahmad S.Pd yang telah mengajar selama 15 tahun.</p>
                        <p>Visi kelas: Menjadi kelas unggulan yang berprestasi dalam akademik dan non-akademik dengan karakter yang baik.</p>
                        <p>Misi kelas: Meningkatkan kualitas pembelajaran, mengembangkan bakat dan minat siswa, serta membangun karakter yang baik.</p>
                        
                        <div class="wali-kelas-card">
                            <img id="waliKelasPhoto" src="https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&q=80" alt="Wali Kelas" class="wali-kelas-photo">
                            <img id="waliKelasPhotoPreview" class="photo-preview" alt="Preview Foto Wali Kelas">
                            <div class="wali-kelas-info">
                                <h3>Bapak Ahmad S.Pd</h3>
                                <p>Wali Kelas X IPA 1</p>
                                <p>Pengalaman mengajar: 15 tahun</p>
                                <p>Spesialisasi: Matematika dan Fisika</p>
                                <div style="margin-top: 10px;">
                                    <input type="file" id="uploadWaliKelasPhoto" accept="image/*" style="display: none;">
                                    <label for="uploadWaliKelasPhoto" class="btn btn-small" style="background-color: rgba(255,255,255,0.2); border: 1px solid white;">Ganti Foto Wali Kelas</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>Jumlah Siswa</h3>
                        <p class="number" id="studentCount">32</p>
                    </div>
                    <div class="info-card">
                        <h3>Jumlah Asrama</h3>
                        <p class="number">4</p>
                    </div>
                    <div class="info-card">
                        <h3>Rata-rata Nilai</h3>
                        <p class="number">85.2</p>
                    </div>
                    <div class="info-card">
                        <h3>Kehadiran</h3>
                        <p class="number">94%</p>
                    </div>
                </div>
            </div>

            <!-- Data Tab Content -->
            <div id="data" class="tab-content">
                <div class="data-header">
                    <h2>Data Siswa</h2>
                    <div class="search-box">
                        <input type="text" id="searchStudent" placeholder="Cari nama siswa...">
                        <button id="addStudentBtn" class="btn">Tambah Siswa</button>
                        <button id="exportExcelBtn" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.884 6.68a.5.5 0 0 0-.772.63L8 11.154l2.888-3.844a.5.5 0 0 0-.772-.63L8 9.69l-2.116-2.01z"/>
                                <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                            </svg>
                            Export Excel
                        </button>
                    </div>
                </div>
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>Foto</th>
                            <th>Nama</th>
                            <th>Kelas</th>
                            <th>Asrama</th>
                            <th>Alamat</th>
                            <th>Jabatan</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Data siswa akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Nilai Tab Content -->
            <div id="nilai" class="tab-content">
                <div class="nilai-header">
                    <h2>Input Nilai Siswa</h2>
                    <div class="file-upload">
                        <input type="file" id="excelFile" accept=".xlsx, .xls">
                        <label for="excelFile">Upload Excel</label>
                        <button id="importBtn" class="btn">Import Nilai</button>
                    </div>
                </div>
                <div class="nilai-table-container">
                    <table class="nilai-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Siswa</th>
                                <th>Matematika</th>
                                <th>Fisika</th>
                                <th>Kimia</th>
                                <th>Biologi</th>
                                <th>Bahasa Indonesia</th>
                                <th>Bahasa Inggris</th>
                                <th>Sejarah</th>
                                <th>Geografi</th>
                                <th>Ekonomi</th>
                                <th>Sosiologi</th>
                                <th>Seni Budaya</th>
                                <th>PJOK</th>
                                <th>Pendidikan Agama</th>
                                <th>PKN</th>
                                <th>TIK</th>
                                <th>Bahasa Jawa</th>
                                <th>Prakarya</th>
                            </tr>
                        </thead>
                        <tbody id="nilaiTableBody">
                            <!-- Data nilai akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="empty-nilai">
                    <h3>Siswa yang Belum Menyelesaikan Ujian</h3>
                    <div id="incompleteExamsList">
                        <!-- Daftar siswa dengan ujian belum selesai -->
                    </div>
                </div>
            </div>

            <!-- Setelan Tab Content -->
            <div id="setelan" class="tab-content">
                <div class="settings-content">
                    <h2>Pengaturan</h2>
                    <p>Atur preferensi dan kelola akun Anda di sini.</p>
                    <button id="settingsLogoutBtn" class="btn logout-btn">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Siswa -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content">
            <h2>Tambah Siswa Baru</h2>
            <div class="form-group">
                <label for="newStudentName">Nama</label>
                <input type="text" id="newStudentName" placeholder="Nama lengkap">
            </div>
            <div class="form-group">
                <label for="newStudentClass">Kelas</label>
                <input type="text" id="newStudentClass" placeholder="Kelas">
            </div>
            <div class="form-group">
                <label for="newStudentDormitory">Asrama</label>
                <input type="text" id="newStudentDormitory" placeholder="Asrama">
            </div>
            <div class="form-group">
                <label for="newStudentAddress">Alamat</label>
                <input type="text" id="newStudentAddress" placeholder="Alamat">
            </div>
            <div class="form-group">
                <label for="newStudentPosition">Jabatan</label>
                <input type="text" id="newStudentPosition" placeholder="Jabatan">
            </div>
            <div class="form-group">
                <label for="newStudentPhoto">Foto Profil</label>
                <input type="file" id="newStudentPhoto" accept="image/*">
                <img id="newStudentPhotoPreview" class="photo-preview" alt="Preview Foto Siswa">
            </div>
            <div class="modal-buttons">
                <button id="cancelAddStudent" class="btn cancel-btn">Batal</button>
                <button id="saveStudent" class="btn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Edit Siswa -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content">
            <h2>Edit Data Siswa</h2>
            <div class="form-group">
                <label for="editStudentName">Nama</label>
                <input type="text" id="editStudentName" placeholder="Nama lengkap">
            </div>
            <div class="form-group">
                <label for="editStudentClass">Kelas</label>
                <input type="text" id="editStudentClass" placeholder="Kelas">
            </div>
            <div class="form-group">
                <label for="editStudentDormitory">Asrama</label>
                <input type="text" id="editStudentDormitory" placeholder="Asrama">
            </div>
            <div class="form-group">
                <label for="editStudentAddress">Alamat</label>
                <input type="text" id="editStudentAddress" placeholder="Alamat">
            </div>
            <div class="form-group">
                <label for="editStudentPosition">Jabatan</label>
                <input type="text" id="editStudentPosition" placeholder="Jabatan">
            </div>
            <div class="modal-buttons">
                <button id="cancelEditStudent" class="btn cancel-btn">Batal</button>
                <button id="updateStudent" class="btn">Update</button>
            </div>
        </div>
    </div>

    <script>
        // Data contoh
        let students = [
            {
                id: 1,
                name: "Ahmad Rizki",
                class: "X IPA 1",
                dormitory: "Asrama A",
                address: "Jl. Merdeka No. 10, Jakarta",
                position: "Ketua Kelas",
                photo: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80",
                incompleteExams: ["Fisika", "Kimia"]
            },
            {
                id: 2,
                name: "Siti Nurhaliza",
                class: "X IPA 1",
                dormitory: "Asrama B",
                address: "Jl. Damai No. 5, Jakarta",
                position: "Bendahara",
                photo: "https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80",
                incompleteExams: ["Matematika"]
            },
            {
                id: 3,
                name: "Budi Santoso",
                class: "X IPA 1",
                dormitory: "Asrama C",
                address: "Jl. Sejahtera No. 15, Jakarta",
                position: "Sekretaris",
                photo: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80",
                incompleteExams: ["Biologi", "Bahasa Inggris"]
            }
        ];

        const subjects = [
            "Matematika", "Fisika", "Kimia", "Biologi", "Bahasa Indonesia", 
            "Bahasa Inggris", "Sejarah", "Geografi", "Ekonomi", "Sosiologi",
            "Seni Budaya", "PJOK", "Pendidikan Agama", "PKN", "TIK",
            "Bahasa Jawa", "Prakarya"
        ];

        let studentGrades = {};
        let currentEditStudentId = null;
        let newStudentPhotoData = null;

        // Login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple validation
            if (username === 'admin' && password === 'admin') {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                initializeApp();
            } else {
                alert('Username atau password salah! Gunakan admin / admin');
            }
        });

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Show corresponding tab content
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Upload foto kelas
        document.getElementById('uploadClassPhoto').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('classPhoto').src = event.target.result;
                    document.getElementById('classPhotoPreview').src = event.target.result;
                    document.getElementById('classPhotoPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Upload foto wali kelas
        document.getElementById('uploadWaliKelasPhoto').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('waliKelasPhoto').src = event.target.result;
                    document.getElementById('waliKelasPhotoPreview').src = event.target.result;
                    document.getElementById('waliKelasPhotoPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Populate students table
        function populateStudentsTable() {
            const tableBody = document.getElementById('studentsTableBody');
            tableBody.innerHTML = '';
            
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="photo-upload">
                            <img src="${student.photo}" alt="${student.name}" class="student-photo" id="photo-${student.id}">
                            <input type="file" id="file-${student.id}" accept="image/*" class="photo-input">
                            <label for="file-${student.id}">Ganti Foto</label>
                        </div>
                    </td>
                    <td>
                        ${student.name}
                        ${student.incompleteExams.length > 0 ? 
                            `<div class="ujian-status">Belum selesai: ${student.incompleteExams.join(', ')}</div>` : 
                            '<div class="ujian-status">Semua ujian selesai</div>'
                        }
                    </td>
                    <td>${student.class}</td>
                    <td>${student.dormitory}</td>
                    <td>${student.address}</td>
                    <td>${student.position}</td>
                    <td>
                        <button class="btn edit-student" data-id="${student.id}" style="padding: 5px 10px; font-size: 14px;">Edit</button>
                        <button class="btn delete-student" data-id="${student.id}" style="padding: 5px 10px; font-size: 14px; background-color: #f44336;">Hapus</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update student count in home tab
            document.getElementById('studentCount').textContent = students.length;
            
            // Add event listeners for photo uploads
            document.querySelectorAll('.photo-input').forEach(input => {
                input.addEventListener('change', function(e) {
                    const studentId = this.id.split('-')[1];
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            document.getElementById(`photo-${studentId}`).src = event.target.result;
                            // Update student data
                            const student = students.find(s => s.id == studentId);
                            if (student) student.photo = event.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    editStudent(studentId);
                });
            });
            
            document.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    deleteStudent(studentId);
                });
            });
        }

        // Populate nilai table
        function populateNilaiTable() {
            const tableBody = document.getElementById('nilaiTableBody');
            tableBody.innerHTML = '';
            
            // Initialize student grades if not exists
            students.forEach(student => {
                if (!studentGrades[student.id]) {
                    studentGrades[student.id] = {};
                    subjects.forEach(subject => {
                        // If student has this subject in incomplete exams, set grade to empty
                        if (student.incompleteExams.includes(subject)) {
                            studentGrades[student.id][subject] = '';
                        } else {
                            // Otherwise, set a random grade
                            studentGrades[student.id][subject] = Math.floor(Math.random() * 31) + 70;
                        }
                    });
                }
            });
            
            students.forEach((student, index) => {
                const row = document.createElement('tr');
                let cells = `<td>${index + 1}</td><td>${student.name}</td>`;
                
                subjects.forEach(subject => {
                    cells += `<td><input type="number" min="0" max="100" placeholder="0-100" 
                              data-student="${student.id}" data-subject="${subject}"
                              value="${studentGrades[student.id][subject] || ''}"></td>`;
                });
                
                row.innerHTML = cells;
                tableBody.appendChild(row);
            });
            
            // Add event listeners for grade inputs
            document.querySelectorAll('#nilaiTableBody input').forEach(input => {
                input.addEventListener('change', function() {
                    const studentId = parseInt(this.getAttribute('data-student'));
                    const subject = this.getAttribute('data-subject');
                    const value = this.value;
                    
                    studentGrades[studentId][subject] = value;
                    updateIncompleteExamsList();
                });
            });
            
            updateIncompleteExamsList();
        }

        // Update list of students with incomplete exams
        function updateIncompleteExamsList() {
            const incompleteExamsList = document.getElementById('incompleteExamsList');
            incompleteExamsList.innerHTML = '';
            
            // Group students by subject with incomplete exams
            const incompleteBySubject = {};
            
            students.forEach(student => {
                subjects.forEach(subject => {
                    if (!studentGrades[student.id][subject] || studentGrades[student.id][subject] === '') {
                        if (!incompleteBySubject[subject]) {
                            incompleteBySubject[subject] = [];
                        }
                        incompleteBySubject[subject].push(student);
                    }
                });
            });
            
            // Display by subject
            Object.keys(incompleteBySubject).forEach(subject => {
                if (incompleteBySubject[subject].length > 0) {
                    const subjectGroup = document.createElement('div');
                    subjectGroup.className = 'subject-group';
                    
                    const subjectTitle = document.createElement('h4');
                    subjectTitle.textContent = `${subject} (${incompleteBySubject[subject].length} siswa)`;
                    subjectGroup.appendChild(subjectTitle);
                    
                    const studentList = document.createElement('div');
                    studentList.className = 'student-list';
                    
                    incompleteBySubject[subject].forEach(student => {
                        const studentTag = document.createElement('div');
                        studentTag.className = 'student-tag';
                        studentTag.innerHTML = `
                            <img src="${student.photo}" alt="${student.name}">
                            <span>${student.name}</span>
                        `;
                        studentList.appendChild(studentTag);
                    });
                    
                    subjectGroup.appendChild(studentList);
                    incompleteExamsList.appendChild(subjectGroup);
                }
            });
            
            if (Object.keys(incompleteBySubject).length === 0) {
                incompleteExamsList.innerHTML = '<p>Semua siswa telah menyelesaikan semua ujian.</p>';
            }
        }

        // Search functionality
        document.getElementById('searchStudent').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#studentsTableBody tr');
            
            rows.forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                if (name.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Add student functionality
        document.getElementById('addStudentBtn').addEventListener('click', function() {
            document.getElementById('addStudentModal').style.display = 'flex';
            newStudentPhotoData = null;
            document.getElementById('newStudentPhotoPreview').style.display = 'none';
        });

        document.getElementById('cancelAddStudent').addEventListener('click', function() {
            document.getElementById('addStudentModal').style.display = 'none';
            resetAddStudentForm();
        });

        // Upload foto untuk siswa baru
        document.getElementById('newStudentPhoto').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    newStudentPhotoData = event.target.result;
                    document.getElementById('newStudentPhotoPreview').src = event.target.result;
                    document.getElementById('newStudentPhotoPreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('saveStudent').addEventListener('click', function() {
            const name = document.getElementById('newStudentName').value;
            const studentClass = document.getElementById('newStudentClass').value;
            const dormitory = document.getElementById('newStudentDormitory').value;
            const address = document.getElementById('newStudentAddress').value;
            const position = document.getElementById('newStudentPosition').value;
            
            if (name && studentClass && dormitory && address && position) {
                const newStudent = {
                    id: students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1,
                    name: name,
                    class: studentClass,
                    dormitory: dormitory,
                    address: address,
                    position: position,
                    photo: newStudentPhotoData || "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80",
                    incompleteExams: [...subjects] // All exams are incomplete for new students
                };
                
                students.push(newStudent);
                populateStudentsTable();
                populateNilaiTable();
                document.getElementById('addStudentModal').style.display = 'none';
                resetAddStudentForm();
                alert('Siswa berhasil ditambahkan!');
            } else {
                alert('Harap isi semua field!');
            }
        });

        function resetAddStudentForm() {
            document.getElementById('newStudentName').value = '';
            document.getElementById('newStudentClass').value = '';
            document.getElementById('newStudentDormitory').value = '';
            document.getElementById('newStudentAddress').value = '';
            document.getElementById('newStudentPosition').value = '';
            document.getElementById('newStudentPhoto').value = '';
            document.getElementById('newStudentPhotoPreview').style.display = 'none';
            newStudentPhotoData = null;
        }

        // Edit student functionality
        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                currentEditStudentId = studentId;
                
                document.getElementById('editStudentName').value = student.name;
                document.getElementById('editStudentClass').value = student.class;
                document.getElementById('editStudentDormitory').value = student.dormitory;
                document.getElementById('editStudentAddress').value = student.address;
                document.getElementById('editStudentPosition').value = student.position;
                
                document.getElementById('editStudentModal').style.display = 'flex';
            }
        }

        document.getElementById('cancelEditStudent').addEventListener('click', function() {
            document.getElementById('editStudentModal').style.display = 'none';
            currentEditStudentId = null;
        });

        document.getElementById('updateStudent').addEventListener('click', function() {
            if (currentEditStudentId) {
                const student = students.find(s => s.id === currentEditStudentId);
                if (student) {
                    student.name = document.getElementById('editStudentName').value;
                    student.class = document.getElementById('editStudentClass').value;
                    student.dormitory = document.getElementById('editStudentDormitory').value;
                    student.address = document.getElementById('editStudentAddress').value;
                    student.position = document.getElementById('editStudentPosition').value;
                    
                    populateStudentsTable();
                    populateNilaiTable();
                    document.getElementById('editStudentModal').style.display = 'none';
                    currentEditStudentId = null;
                    
                    alert('Data siswa berhasil diupdate!');
                }
            }
        });

        function deleteStudent(studentId) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                students = students.filter(s => s.id !== studentId);
                populateStudentsTable();
                populateNilaiTable();
                alert('Siswa berhasil dihapus!');
            }
        }

        // Excel import functionality
        document.getElementById('importBtn').addEventListener('click', function() {
            alert('Fitur import dari Excel akan mengisi nilai siswa secara otomatis. (Fitur simulasi)');
            
            // Simulate importing grades
            students.forEach(student => {
                subjects.forEach(subject => {
                    // Only fill grades for exams that are not incomplete
                    if (!student.incompleteExams.includes(subject)) {
                        studentGrades[student.id][subject] = Math.floor(Math.random() * 26) + 70;
                    }
                });
            });
            
            populateNilaiTable();
            alert('Nilai berhasil diimport dari file Excel!');
        });

        // Export to Excel functionality
        document.getElementById('exportExcelBtn').addEventListener('click', function() {
            // Create CSV content
            let csvContent = "Nama,Kelas,Asrama,Alamat,Jabatan,Ujian Belum Selesai\n";
            
            students.forEach(student => {
                const row = [
                    student.name,
                    student.class,
                    student.dormitory,
                    student.address,
                    student.position,
                    student.incompleteExams.join(', ')
                ];
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'data_siswa.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Data siswa berhasil diexport!');
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('settingsLogoutBtn').addEventListener('click', logout);
        
        function logout() {
            document.getElementById('app').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Initialize the app
        function initializeApp() {
            populateStudentsTable();
            populateNilaiTable();
        }
    </script>
</body>
</html>